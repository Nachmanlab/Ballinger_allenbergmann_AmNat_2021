---
title: "Developmental plasticity of body weight and absolute tail length in New York mice and Brazil mice"
author: "Mallory A. Ballinger"
date: "02/11/2021"
output: 
  github_document:
    html_preview: false
editor_options: 
  chunk_output_type: console
---

```{r libraries_and_data, message=FALSE}
rm(list = ls()) # clears R's "memory"
library(tidyverse)
library(here)
library(cowplot)

# Read in and format data
WeeklyMetaData1 <- read_csv(here("data/raw/weekly_metadata_RAW_2021-02-11.csv")) %>%
  filter(Population == "BRAZIL" | Population == "NEW_YORK") %>% # only keep parental populations (remove F1 hybrids)
  filter(Age_category == "startexp" | Age_category == "endexp") %>%
  #filter(Age_weeks > 3) %>%  # NY lines sometimes were weaned & measured slightly before 3 weeks
  #filter(Age_weeks < 12) %>%
  mutate(Sex = fct_recode(Sex, "Female" = "F", "Male" = "M")) %>% # spells out males and females
  mutate(Line = fct_recode(Line, "MANA" = "193x255", "SARA" = "19x13",
                           "MANB" = "222x254", "SARB" = "82x81")) %>% # gives each line the "published"/JAX name
  mutate(Population = fct_recode(Population, "Brazil" = "BRAZIL", "New York" = "NEW_YORK")) %>% # modifies names of populations
  mutate(Line = fct_relevel(Line, "MANA", "MANB", "SARA", "SARB")) %>% # puts Brazil lines before New York lines
  mutate(Environment = fct_relevel(Environment,
                                   "RT", "COLD" )) %>% # puts RT before COLD
  mutate(Age_category = fct_relevel(Age_category, "startexp", "endexp")) %>% # puts startexp before endexp (for plotting purposes)
  mutate(Sex = fct_relevel(Sex, "Male", "Female")) # puts males before females

```
# The analyses and code associated here are adapted in downstream analyses to look at plasticity in these traits across populations for manuscript figures (e.g. code/plot_weekly_figures.R).


### Evolved differences (i.e. RT-only data) - separates out population-specific lines
```{r evolved_bodysize_and_taillength, message=FALSE, echo=FALSE}
RTWeeklyData <- WeeklyMetaData1 %>%
  filter(Environment == "RT")

BodyWeight <-
  ggplot(data=RTWeeklyData, aes(x=Age_weeks, y=BodyWeight_g, color=Line)) +
  geom_smooth(aes(color=Line), size=1, method="loess", show.legend = F) + #std error
  geom_point(position = position_dodge(0.1), size=1.5, alpha=0.5) +
  scale_x_continuous() +
  facet_wrap(facets = "Sex", scales = "fixed") +
  theme_half_open(12) +
  panel_border() +
  theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 20), size = 15, face = "bold"),
        axis.text.x = element_text(size = 12, face = "bold", color = "black"),
        axis.text.y = element_text(size = 12, face = "bold", color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        plot.title = element_text(size = 20, face = "bold", hjust = 0.5)) +
  labs(x = "Age (weeks)", y = "Body Weight (g)")
BodyWeight


TailLength <-
  ggplot(data=RTWeeklyData, aes(x=Age_weeks, y=TailLength_mm, color=Line)) +
  geom_smooth(aes(linetype=Environment, color=Line), size=1, method="loess", show.legend = F) + #std error
  geom_point(position = position_dodge(0.1), size=1.5, alpha=0.5) +
  coord_cartesian(xlim = c(3,12), ylim = c(35,90)) +
  facet_wrap(facets = "Sex", scales = "fixed") +
  theme_half_open(12) +
  panel_border() +
  theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
        axis.title.x = element_text(margin = margin(t = 10), size = 15, face = "bold"),
        axis.title.y = element_text(margin = margin(r = 20), size = 15, face = "bold"),
        axis.text.x = element_text(size = 12, face = "bold", color = "black"),
        axis.text.y = element_text(size = 12, face = "bold", color = "black"),
        legend.title = element_blank(),
        legend.key = element_rect(),
        legend.position = "bottom",
        legend.key.size = unit(1, "cm"),
        legend.text = element_text(size=12),
        plot.title = element_text(size = 20, face = "bold", hjust = 0.5)) +
  labs(x = "Age (weeks)", y = "Tail Length (mm)", fill = "Line")
TailLength

plot_grid(BodyWeight, TailLength, labels = c('A', 'B'), ncol = 1, nrow = 2)
```
##### SARB is clearly the largest mouse line, while MANA is clearly the smallest mosue line.

##### Population-level differences split out absolute tail length differences, while each mouse line has their "own" body weight trajectory.

##### Also, looks like males grow faster (and larger) than females - interesting! Will need to plot growth rates to tease this observation apart.



### Plot "reaction norms" of body weight and tail length at start and end of experiment
```{r rxn_norm_plots_bodysize_and_taillength, message=FALSE, echo=FALSE}

BodyWeight <-
  ggplot(data=RTWeeklyData, aes(x=Age_category, y=BodyWeight_g, color=Line)) +
  geom_boxplot() +
  facet_wrap(facets = "Sex", scales = "fixed") +
  theme_half_open(12) +
  panel_border() +
  theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 20), size = 15, face = "bold"),
        axis.text.x = element_text(size = 12, face = "bold", color = "black"),
        axis.text.y = element_text(size = 12, face = "bold", color = "black"),
        legend.title = element_blank(),
        legend.position = "none",
        plot.title = element_text(size = 20, face = "bold", hjust = 0.5)) +
  labs(x = "Age (weeks)", y = "Body Weight (g)")
BodyWeight


TailLength <-
  ggplot(data=RTWeeklyData, aes(x=Age_weeks, y=TailLength_mm, color=Line)) +
  geom_smooth(aes(linetype=Environment, color=Line), size=1, method="loess", show.legend = F) + #std error
  geom_point(position = position_dodge(0.1), size=1.5, alpha=0.5) +
  #scale_color_manual(values=c("goldenrod1","dodgerblue4")) +
  coord_cartesian(xlim = c(3,12), ylim = c(35,90)) +
  facet_wrap(facets = "Sex",
             #strip.position = "top",
             scales = "fixed") +
             #labeller=labeller(Sex = sex_labels)) +
  theme_half_open(12) +
  panel_border() +
  theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
        axis.title.x = element_text(margin = margin(t = 10), size = 15, face = "bold"),
        axis.title.y = element_text(margin = margin(r = 20), size = 15, face = "bold"),
        axis.text.x = element_text(size = 12, face = "bold", color = "black"),
        axis.text.y = element_text(size = 12, face = "bold", color = "black"),
        legend.title = element_blank(),
        legend.key = element_rect(),
        legend.position = "bottom",
        legend.key.size = unit(1, "cm"),
        legend.text = element_text(size=12),
        #legend.key = element_rect(fill = NA, color = NA),
        plot.title = element_text(size = 20, face = "bold", hjust = 0.5)) +
  labs(x = "Age (weeks)", y = "Tail Length (mm)", fill = "Line")
TailLength

plot_grid(BodyWeight, TailLength, labels = c('A', 'B'), ncol = 1, nrow = 2)
```


## Let's collapse the lines into populations (since for the paper, I'm mostly interested in population-level differences, not within-in and across population differences)

### Population differences and population-specific differences in developmental plasticity
```{r, message=FALSE, echo=FALSE}
WeeklyMetaData2 <- read_csv(here("data/raw/weekly_metadata_RAW_2021-02-11.csv")) %>%
  filter(Population == "BRAZIL" | Population == "NEW_YORK") %>% # only keep parental populations (remove F1 hybrids)
  mutate(Sex = fct_recode(Sex, "Female" = "F", "Male" = "M")) %>% # spells out males and females
  mutate(Environment = fct_recode(Environment, "Cold" = "COLD", "Warm" = "RT")) %>%
  mutate(Line = fct_recode(Line, "MANA" = "193x255", "SARA" = "19x13",
                           "MANB" = "222x254", "SARB" = "82x81")) %>% # gives each line the "published"/JAX name
  mutate(Population = fct_recode(Population, "Brazil" = "BRAZIL", "NewYork" = "NEW_YORK")) %>% # modifies names of populations
  mutate(Line = fct_relevel(Line, "MANA", "MANB", "SARA", "SARB")) %>% # puts Brazil lines before New York lines
  mutate(Environment = fct_relevel(Environment, "Warm", "Cold" )) %>% # puts Warm before Cold
  mutate(PopEnv = paste(Population, Environment, sep = "_")) %>%
  mutate(PopEnv = fct_recode(PopEnv, "Brazil - Warm" = "Brazil_Warm", "Brazil - Cold" = "Brazil_Cold",
                             "New York - Warm" = "NewYork_Warm", "New York - Cold" = "NewYork_Cold")) %>%
  mutate(PopEnv = fct_relevel(PopEnv, "New York - Warm", "New York - Cold", "Brazil - Warm", "Brazil - Cold"))

```

```{r, pop_dev_plasticity, message=FALSE, echo=FALSE}

BodyWeight <-
  ggplot(data=WeeklyMetaData2, aes(x=Age_weeks, y=BodyWeight_g, color = PopEnv, fill = PopEnv, linetype = PopEnv)) +
  geom_point(position = position_dodge(0.1), size=1.2, alpha = 0.5, show.legend = FALSE) +
  geom_smooth(aes(group = PopEnv), size=1.5, alpha = 0.15, method = "loess", se = TRUE) + #std error
  scale_color_manual(values=rep(c("dodgerblue4", "dodgerblue4", "goldenrod1", "goldenrod1"))) +
  scale_fill_manual(values=rep(c("dodgerblue4", "dodgerblue4", "darkorange4","darkorange4"))) +
  scale_linetype_manual(values=rep(c("solid","dashed", "solid", "dashed"))) +
  guides(color=guide_legend(override.aes=list(fill=NA)),
         linetype=guide_legend(override.aes = list(size=0.5)),
         linetype=guide_legend(override.aes = list(fill=NA))) +# removes gray shading from legend
  scale_x_continuous(breaks = seq(from=3, to=12, by=2), labels = seq(from=3, to=12, by=2), limits = c(3,11.5)) +
  scale_y_continuous(breaks = seq(from=5, to=25, by=5), labels = seq(from=5, to=25, by=5), limits = c(5,25)) +
  facet_wrap(facets = "Sex", scales = "fixed") +
  theme_half_open(20) +
  panel_border() + # puts border around facets
  theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(margin = margin(r = 10), size = 11, face = "bold", family = "Palatino"),
        axis.text.x = element_text(size = 10, face = "bold", color = "black", family = "Palatino"),
        axis.text.y = element_text(size = 10, face = "bold", color = "black", family = "Palatino"),
        strip.background =element_rect(fill="white"),
        strip.text = element_text(colour = 'black', face = "bold", family = "Palatino", size = 10, lineheight = 0.5),
        legend.position = c(0.03, 0.9),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.key.height = unit(0.3, "cm"),
        legend.key.width = unit(1.5, "cm"),
        legend.text = element_text(size=8, family = "Palatino"),
        legend.title = element_blank()) +
  labs(x = "",
       y = "Body Weight (g)")

TailLength <-
  ggplot(data=WeeklyMetaData2, aes(x=Age_weeks, y=TailLength_mm, color = PopEnv, fill = PopEnv, linetype = PopEnv)) +
  geom_point(position = position_dodge(0.1), size=1.2, alpha=0.5, show.legend = FALSE) +
  geom_smooth(aes(group = PopEnv), size=1.5, method = "loess", alpha = 0.15, se = TRUE) + #std error
  scale_color_manual(values=rep(c("dodgerblue4", "dodgerblue4", "goldenrod1","goldenrod1"))) +
  scale_fill_manual(values=rep(c("dodgerblue4", "dodgerblue4", "darkorange4","darkorange4"))) +
  scale_linetype_manual(values=rep(c("solid","dashed", "solid", "dashed"))) +
  guides(color=guide_legend(override.aes=list(fill=NA)),
         linetype=guide_legend(override.aes = list(fill=NA))) + # removes gray shading from legend
  scale_x_continuous(breaks = seq(from=3, to=12, by=2), labels = seq(from=3, to=12, by=2), limits = c(3,11.5)) +
  scale_y_continuous(breaks = seq(from=45, to=90, by=10), labels = seq(from=45, to=90, by=10), limits = c(45,85)) +
  facet_wrap(facets = "Sex", scales = "fixed") +
  theme_half_open(20) +
  panel_border() + # puts border around facets
  theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
        axis.title.x = element_text(margin = margin(t = 10), size = 11, face = "bold", family = "Palatino"),
        axis.title.y = element_text(margin = margin(r = 10), size = 11, face = "bold", family = "Palatino"),
        axis.text.x = element_text(size = 10, face = "bold", color = "black", family = "Palatino"),
        axis.text.y = element_text(size = 10, face = "bold", color = "black", family = "Palatino"),
        strip.background =element_rect(fill="grey93"),
        strip.text = element_text(colour = 'black', face = "bold", family = "Palatino", size = 10, lineheight = 0.5),
        legend.position = "none",
        # legend.background = element_blank(),
        # legend.box.background = element_blank(),
        # legend.key = element_blank(),
        # legend.key.height = unit(0.75, "cm"),
        # legend.key.width = unit(1.5, "cm"),
        # legend.text = element_text(size=11, family = "Palatino"),
        # legend.title = element_blank(),
        plot.title = element_text(size = 20, face = "bold", hjust = 0.5)) +
  labs(x = "Age (weeks)",
       y = "Tail Length (mm)")

plot_grid(BodyWeight, TailLength, labels = c('A', 'B'), ncol = 1, nrow = 2)
```


```{r, pop_dev_plasticity_RXN, message=FALSE, echo=FALSE}
# DevelopmentM <- MaleData %>%
#   filter(Age_category == "weaning" | Age_category == "endexp") %>%
#   mutate(Age_category = fct_relevel(Age_category, "weaning", "endexp" )) # puts weaning before adult
# 
# BodyWeightRXN <-
#   ggplot(data=DevelopmentM, aes(x=Age_category, y=BodyWeight_g)) +
#   geom_jitter(aes(color = PopEnv), position = position_dodge(0.1), alpha=2, size=3, shape=21) +
#   geom_boxplot(aes(color = PopEnv), position = position_dodge(width=0.75), alpha=0.65, outlier.shape = NA, notch = FALSE, fill = NA) +
#   scale_color_manual(values=rep(c("dodgerblue4", "dodgerblue1", "goldenrod4","goldenrod1"))) +
#   scale_fill_manual(values=rep(c("dodgerblue4", "dodgerblue1", "goldenrod4","golenrod11"))) +
#   scale_linetype_manual(values=rep(c("solid","dashed", "solid", "dashed"))) +
#   scale_x_discrete(labels=c("start", "end")) +
#   stat_summary(
#     fun = median,
#     geom = 'line',
#     aes(group = PopEnv, color = PopEnv, linetype = PopEnv),
#     position = "identity", size=1.5) +
#   theme_half_open(12) +
#   panel_border() +
#   theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
#         axis.title.x = element_blank(),
#         axis.title.y = element_text(margin = margin(r = 20), size = 15, face = "bold"),
#         axis.text.x = element_text(size = 12, face = "bold", color = "black"),
#         axis.text.y = element_text(size = 12, face = "bold", color = "black"),
#         legend.title = element_blank(),
#         legend.position = "none",
#         plot.title = element_text(size = 20, face = "bold", hjust = 0.5)) +
#   labs(x = "Age (weeks)", y = "Body Weight (g)")
# BodyWeightRXN
# 
# TailLengthRXN <-
#   ggplot(data=DevelopmentM, aes(x=Age_category, y=TailLength_mm)) +
#   geom_jitter(aes(color = PopEnv), position = position_dodge(0.1), alpha=2, size=3, shape=21) +
#   geom_boxplot(aes(color = PopEnv), position = position_dodge(width=0.75), alpha=0.65, outlier.shape = NA, notch = FALSE, fill = NA) +
#   scale_color_manual(values=rep(c("dodgerblue4", "dodgerblue1", "goldenrod3","goldenrod1"))) +
#   scale_fill_manual(values=rep(c("dodgerblue4", "dodgerblue1", "goldenrod3","golenrod11"))) +
#   scale_linetype_manual(values=rep(c("solid","dashed", "solid", "dashed"))) +
#   scale_x_discrete(labels=c("start", "end")) +
#   stat_summary(
#     fun = median,
#     geom = 'line',
#     aes(group = PopEnv, color = PopEnv, linetype = PopEnv),
#     position = "identity", size=1.5) +
#   theme_half_open(12) +
#   panel_border() +
#   theme(panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
#         axis.title.x = element_blank(),
#         axis.title.y = element_text(margin = margin(r = 20), size = 15, face = "bold"),
#         axis.text.x = element_text(size = 12, face = "bold", color = "black"),
#         axis.text.y = element_text(size = 12, face = "bold", color = "black"),
#         legend.title = element_blank(),
#         legend.position = "none",
#         plot.title = element_text(size = 20, face = "bold", hjust = 0.5)) +
#   labs(x = "Age (weeks)", y = "Tail Length (mm)")
# TailLengthRXN

```